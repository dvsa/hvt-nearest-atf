{% from "includes/atf/macro.njk" import renderAtf %}
{% from "includes/pagination/macro.njk" import pagination %}
{% from "govuk-frontend/govuk/components/details/macro.njk" import govukDetails %}
{% from "govuk-frontend/govuk/components/checkboxes/macro.njk" import govukCheckboxes %}
{% from "govuk-frontend/govuk/components/button/macro.njk" import govukButton %}

{% extends "layouts/layout.njk" %}

{% block backLink %}
  {{ govukBackLink({
    href: "/",
    text: "Back",
    attributes: { id: "back-link" }
  }) }}
{% endblock %}

{% block content %}
  <h1 class="govuk-heading-xl dvsa-no-margin-bottom">
    Test centres near '{{ searchNormalised | escape }}'
    <p class="govuk-body-s"></p>
  </h1>
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-one-half govuk-hint">
      {% set start = (paginationSettings.currentPage - 1) * paginationSettings.perPage + 1 %}
      {% set end = start + paginationSettings.itemsCount - 1 %}
      {% set total = paginationSettings.scannedItemsCount %}
      Showing {{ start }} to {{ end }} of {{ total }} results
    </div>
    <div class="govuk-grid-column-one-half">
      {% set filterUrl = "?postcode=" + search %}
      <form action={{filterUrl}} method="POST" id="filter-results-form">
        {{ govukCheckboxes({
          name: "filters",
          classes: "govuk-checkboxes--small",
          fieldset: {
            legend: {
              text: "Filter the results"
            }
          },
          items: [
            {
              id: "remove-no-availability-filter-checkbox",
              value: "removeNoAvailability",
              text: "Remove fully booked test centres",
              checked: filters.removeAtfsWithNoAvailability
            }
          ]
        }) }}
        <div class="govuk-button-group">
          {{ govukButton({
            text: "Filter",
            attributes: {
              id: "filters-submit-button"
            }
          }) }}

          {% set clearFiltersLink = "?postcode=" + search %}
          <a class="govuk-link govuk-link--no-visited-state govuk-!-padding-1"
            href={{clearFiltersLink}} id="clear-filters-link">
            Clear filters
          </a>
        </div>
      </form>
    </div>
  </div>

  <div class="search-results">
    <hr>
    {% for atf in data %}
      {{ renderAtf(atf) }}
      <hr class="clear">
    {% endfor %}
  </div>


  <div class="govuk-grid-row">
    {{ govukDetails({
      summaryText: "Report that you cannot book an HGV, bus or trailer MOT test",
      html: "<a class='govuk-link' href='https://www.gov.uk/guidance/report-that-you-cannot-book-an-hgv-bus-or-trailer-mot'>Tell DVSA</a> if you cannot find a test centre before your HGV, bus or trailer MOT is due."
    }) }}
  </div>

  <div class="govuk-grid-row">
    {{ pagination({
      paginationSettings: paginationSettings,
      searchUri: "?postcode=" + search + "&removeAtfsWithNoAvailability=" + filters.removeAtfsWithNoAvailability
    }) }}
  </div>
{% endblock %}
